(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{"03b6":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"topo-fullscreen"},[t.prompt?t._e():a("TopoRenderpage",{attrs:{configData:t.configData,facilityData:t.facilityData,deviceList:t.deviceList}}),a("q-dialog",{attrs:{persistent:""},model:{value:t.prompt,callback:function(e){t.prompt=e},expression:"prompt"}},[a("q-card",{staticStyle:{"min-width":"350px"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("请登录")])]),a("q-card-section",{staticClass:"q-pt-none"},[a("q-input",{attrs:{dense:"",autofocus:"",placeholder:"用户名"},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.prompt=!1}},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),a("q-card-section",{staticClass:"q-pt-none"},[a("q-input",{attrs:{dense:"",autofocus:"",placeholder:"密码",type:"password"},on:{keyup:function(e){if(!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.prompt=!1}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),a("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"登录"},on:{click:function(e){return t.clicklogin()}}})],1)],1)],1)],1)},i=[],o=(a("7f7f"),a("967e")),r=a.n(o),s=(a("96cf"),a("fa84")),c=a.n(s),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.configData.layer?a("div",{staticClass:"topo-render",style:t.layerStyle},[t._l(t.configData.components,(function(e,n){return[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.style.visible||e.style.visible.value,expression:"\n        component.style.visible == true ? true : component.style.visible.value\n      "}],key:n,staticClass:"topo-render-wrapper",class:e.style.animate,style:{left:e.style.position.x+"px",top:e.style.position.y+"px",width:e.style.position.w+"px",height:e.style.position.h+"px",backgroundColor:e.style.backColor,zIndex:e.style.zIndex,borderWidth:e.style.borderWidth+"px",borderStyle:e.style.borderStyle,borderColor:e.style.borderColor,"animation-duration":e.style.animationDuration,transform:e.style.transform?"rotate("+e.style.transform+"deg)":"rotate(0deg)"},on:{click:function(a){return t.doClickComponent(e)},dblclick:function(a){return t.doDbClickComponent(e)}}},[a(t.parseView(e),{ref:"spirit",refInFor:!0,tag:"component",attrs:{detail:e}})],1)]}))],2):t._e()},u=[],d=(a("8e6e"),a("8a81"),a("ac6a"),a("cadf"),a("06db"),a("456d"),a("c47a")),p=a.n(d),f=a("6e0e"),m=a("3693"),h=a("2f62");function v(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function y(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?v(Object(a),!0).forEach((function(e){p()(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var g={name:"TopoRender",extends:f["a"],props:["facilityData","deviceList","configData"],components:{},computed:y(y({},Object(h["d"])({topoData:function(t){return t.topoEditor.topoData}})),{},{layerStyle:function(){var t=[];this.configData.layer.backColor&&t.push("background-color: ".concat(this.configData.layer.backColor)),this.configData.layer.backgroundImage&&t.push('background-image: url("'.concat(this.configData.layer.backgroundImage,'")')),this.configData.layer.width>0&&t.push("width: ".concat(this.configData.layer.width,"px")),this.configData.layer.height>0&&t.push("height: ".concat(this.configData.layer.height,"px"));var e=t.join(";");return e}}),watch:{facilityData:function(){clearInterval(this.timer),this.$nextTick((function(){var t=this;this.$refs.spirit.map((function(e){t.deviceList.map((function(t){e.detail.dataBind.queryParam.sensor_facility==t.dev_cn_name&&(e.detail.dataBind.queryParam.devunit_name=t.devunit_name)})),t.facilityData.map((function(a){e.detail.dataBind.queryParam.devunit_name==a.devunit_name&&a.data.map((function(a){a.varId==e.detail.dataBind.queryParam.sensor_No&&(t.timer=setInterval((function(){0==isNaN(a.varValue)&&(console.log(parseInt(a.varValue)),e.detail.style.text=(parseInt(a.varValue)*(1+Math.floor(10*Math.random())/1e3)).toFixed(2))}),1e3))}))})),t.configData.components.map((function(t){e.detail})),"buttom"==e.detail.type&&(e.buttomdata.url=1==e.detail.style.text?"statics/topo/svg/on1.svg":"statics/topo/svg/off1.svg")}))}))}},data:function(){return{buttomdata:{isclick:!0,identifier:"",url:""},temp:"",devicedata:[],timer:""}},methods:{parseView:function(t){return m["a"].parseViewName(t)},doClickComponent:function(t){var e=this;"buttom"==t.type&&this.$refs.spirit.map((function(a){a.detail.name==t.name&&(void 0==a.detail.style.text&&e.$message.error("设备未绑定"),a.buttomdata.isclick=1!=a.buttomdata.isclick,a.buttomdata.url=1==a.buttomdata.isclick?"statics/topo/svg/on1.svg":"statics/topo/svg/off1.svg")}));for(var a=0;a<t.action.length;a++){var n=t.action[a];"click"==n.type&&(this.handleComponentActuib(n),console.log("click"))}},doDbClickComponent:function(t){for(var e=0;e<t.action.length;e++){var a=t.action[e];"dblclick"==a.type&&this.handleComponentActuib(a)}},handleComponentActuib:function(t){var e=this;"visible"==t.action?(t.showItems.length>0&&t.showItems.forEach((function(t){e.showComponent(t,!0)})),t.hideItems.length>0&&t.hideItems.forEach((function(t){e.showComponent(t,!1)}))):"Invisible"==t.action&&e.sendFun(t)},showComponent:function(t,e){console.log("show:"+t+",visible:"+e);for(var a=this.$refs["spirit"],n=0;n<a.length;n++){var i=a[n];if(i.detail.identifier==t){i.detail.style.visible=e;break}}}},created:function(){},mounted:function(){}},b=g,w=(a("6c21"),a("2877")),k=Object(w["a"])(b,l,u,!1,null,null,null),x=k.exports,D=a("1c46"),_=a.n(D),C=a("a55b"),O=(a("3022"),{name:"TopoFullscreen",components:{TopoRenderpage:x,Login:C["a"]},watch:{prompt:function(){this.getidData(),this.getFacilityDevunit()}},data:function(){return{facilityData:[],facility_param:[],facility_devunit_list:[],deviceList:[],newdeviceList:[],component:[],prompt:!0,username:"text",password:"123",showerr:"",configData:"",loading:!0}},methods:{getmd5:function(t){var e=_.a.createHash("md5"),a=e.update(t).digest("hex");return a},clicklogin:function(){var t=this;return c()(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.post("/api/admin/login",{user_account:t.username,user_password:t.getmd5(t.password)}).then((function(e){0===e.data.ret_code?(t.username=t.username,t.prompt=!1):t.$message.error(e.data.ret_msg)}));case 2:case"end":return e.stop()}}),e)})))()},getFacilityDevunit:function(){var t=this;return c()(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$axios.post("/api/devunit/manage/list",{project_name:t.configData.name}).then((function(e){var a=[];t.deviceList=e.data.extra,e.data.extra.map((function(t){a.push(t.devunit_name)})),t.facility_devunit_list=a,t.getFacilitydata(a),console.log(t.deviceList)}));case 2:case"end":return e.stop()}}),e)})))()},getFacilitydata:function(t){var e=this;return c()(r.a.mark((function a(){var n;return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e,e.$axios.post("/api/gateway/real/objdata",{devunit_name:t}).then((function(t){n.facilityData=t.data.extra}));case 2:case"end":return a.stop()}}),a)})))()},getidData:function(){var t=this;return c()(r.a.mark((function e(){var a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t,e.next=3,t.$axios.post("/api/drag/listid",{id:a.$route.query.id}).then((function(e){e.data.extra[0].project_showname==t.username?(a.temp=e.data.extra[0].dargjsondata,t.configData=JSON.parse(e.data.extra[0].dargjsondata)):t.$message({message:"无权限",type:"warning"})}));case 3:case"end":return e.stop()}}),e)})))()}},mounted:function(){this.clicklogin();var t=this;setInterval((function(){t.getFacilityDevunit(t.temp.name)}),6e4)}}),j=O,q=(a("c760"),Object(w["a"])(j,n,i,!1,null,null,null));e["default"]=q.exports},"6c21":function(t,e,a){"use strict";var n=a("f101"),i=a.n(n);i.a},c760:function(t,e,a){"use strict";var n=a("d5bf"),i=a.n(n);i.a},d5bf:function(t,e,a){},f101:function(t,e,a){}}]);